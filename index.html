<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wage Estimator Sacramento 2026-2029</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        /* Modern, Responsive CSS */
        :root {
            --primary-color: #004d99; /* UC Navy Blue (Used for UC Offers in chart/table) */
            --secondary-color: #f7b731; /* Accent Yellow */
            --background-color: #f4f7f6;
            --text-color: #333;
            --success-color: #28a745;
            --danger-color: #dc3545; /* CNA Red (Used for TA in chart/table) */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 95%; /* Wider container for the larger table */
            margin: 0 auto;
            padding: 20px 10px;
        }

        /* Banner Styling */
        .banner {
            background-color: var(--primary-color);
            color: white;
            padding: 30px 15px;
            text-align: center;
            border-bottom: 5px solid var(--secondary-color);
        }

        .banner h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .banner small {
            display: block;
            margin-top: 5px;
            font-style: italic;
            font-size: 0.85em;
        }

        /* Input Form Styling */
        .input-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            background-color: #fff;
            font-size: 1em;
        }

        button {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #e0a82b;
        }

        /* Instruction Styling */
        .instruction {
            margin-top: 20px;
            padding: 15px;
            background-color: #ffeccf;
            border-left: 5px solid var(--secondary-color);
            border-radius: 5px;
        }

        /* Results Styling */
        #results-area {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px dashed #ccc;
        }

        .result-card {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto; /* Allow horizontal scroll for wide tables */
        }

        .result-card h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        
        #results-area h2, #results-area h3 {
            text-align: center;
        }

        .result-table {
            width: 100%;
            min-width: 700px; /* Ensure wide table stays readable */
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .result-table th, .result-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            white-space: nowrap;
        }

        .result-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            text-align: center;
        }

        .result-table td:nth-child(1) {
            font-weight: bold;
            text-align: center;
        }

        /* ONLY colorize the specific comparison table */
        .comparison-table td:nth-child(2) { /* Tentative Agreement (TA) Column - Red */
            background-color: #fff0f6; /* Light Red Background */
            color: var(--danger-color); /* Red Text */
            font-weight: bold;
        }
        .comparison-table td:nth-child(3) { /* UC Initial Offer (UC) Column - Navy Blue */
            background-color: #e6f7ff; /* Light Blue Background */
            color: var(--primary-color); /* Navy Blue Text */
            font-weight: bold;
        }


        .note {
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-size: 0.9em;
            font-style: italic;
        }

        .ta-note {
            background-color: #ffeccf;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            font-weight: bold;
        }
        
        /* Summary Box */
        .total-summary {
            background: white; /* Resetting card background */
            border: none;
            text-align: center;
            padding: 15px;
            /* Using a light blue background for the overall summary card */
            background-color: #e6f7ff; 
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .total-summary h3 {
            color: var(--primary-color);
            margin: 0 0 15px 0;
            font-size: 1.4em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        .total-summary p {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0;
        }
        .total-summary small {
            font-size: 0.85em;
            font-style: italic;
            color: var(--text-color);
            margin-top: 10px;
            display: block;
        }

        .uc-note {
            background-color: #e6f7ff;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .pay-scale {
            margin-top: 30px;
        }

        .pay-scale h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        /* Chart Styling */
        .chart-container {
            width: 100%;
            margin-top: 20px;
            padding: 20px 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Responsive adjustments */
        @media (min-width: 600px) {
            .container {
                max-width: 900px;
            }
            .banner h1 {
                font-size: 2.5em;
            }
            .input-group select {
                padding: 12px;
            }
        }
    </style>
</head>
<body>

    <div class="banner">
        <h1>WAGE ESTIMATOR SACRAMENTO 2026-2029 CNA CONTRACT</h1>
        <small>Disclaimer: Rough estimate, real numbers might vary case by case.</small>
        <small>Coded by AI - Presented by Dai Dang</small>
    </div>

    <div class="container">
        <div class="input-card">
            
            <div class="input-group">
                <label for="classification">Nursing Classification</label>
                <select id="classification">
                    <!-- Options populated by JavaScript -->
                </select>
            </div>

            <div class="input-group">
                <label for="step">Step (2025 Current)</label>
                <select id="step">
                    <!-- Options populated by JavaScript -->
                </select>
            </div>

            <button onclick="generateWages()">Generate Comparison</button>

            <div class="instruction">
                <p>***<span style="font-weight: bold; font-style: italic;">Please select your Nursing Classification and Step. Refer to 2025 Pay Scale below for your current step. If you don't know your step, check your paycheck and look for Pay Rate on top of your paycheck and compare to the Pay Scale.***</span></p>
            </div>
        </div>

        <div id="results-area" style="display:none;">
            <!-- Results will be displayed here -->
        </div>
        
        <div class="pay-scale">
            <h2>2025 Current Pay Scale (Hourly Rate)</h2>
            <div class="result-card">
                <table class="result-table">
                    <thead>
                        <!-- Table header inserted by JavaScript -->
                    </thead>
                    <tbody id="pay-scale-body">
                        <!-- Pay scale data inserted by JavaScript -->
                    </tbody>
                </table>
                <small class="note ta-note">Scroll horizontally on mobile devices to see all classifications.</small>
            </div>
        </div>

    </div>

    <script>
        // --- DATA DEFINITIONS ---

        // Map of classification short codes to full names and step ranges
        const classificationDetails = {
            CN2: { name: "Clinical Nurse 2", min: 0, max: 16 },
            CN3: { name: "Clinical Nurse 3", min: 1, max: 18 },
            NP1: { name: "Nurse Practitioner 1", min: 1, max: 15 },
            NP2: { name: "Nurse Practitioner 2", min: 1, max: 15 },
            CO1: { name: "Coordinator 1", min: 1, max: 18 },
            CO2: { name: "Coordinator 2", min: 1, max: 18 },
            CRNA: { name: "CRNA", min: 1, max: 15 }
        };

        // 2025 Base Rates (Hourly) - Updated with 5 new classifications
        const payScale = {
            CN2: { 0: 70.21, 1: 73.72, 2: 75.17, 3: 76.70, 4: 78.23, 5: 79.84, 6: 81.41, 7: 83.03, 8: 84.69, 9: 86.38, 10: 88.08, 11: 89.89, 12: 91.65, 13: 93.48, 14: 95.37, 15: 97.24, 16: 99.20 },
            CN3: { 1: 77.40, 2: 78.97, 3: 80.54, 4: 82.14, 5: 83.80, 6: 85.46, 7: 87.17, 8: 88.98, 9: 90.82, 10: 92.56, 11: 94.37, 12: 96.27, 13: 98.18, 14: 100.13, 15: 102.12, 16: 103.21, 17: 105.30, 18: 107.45 },
            NP1: { 1: 83.56, 2: 85.22, 3: 86.88, 4: 88.64, 5: 90.40, 6: 92.20, 7: 94.05, 8: 95.93, 9: 97.84, 10: 99.80, 11: 101.80, 12: 103.85, 13: 105.93, 14: 108.05, 15: 110.19 },
            NP2: { 1: 87.69, 2: 89.45, 3: 91.22, 4: 93.04, 5: 94.90, 6: 96.81, 7: 98.74, 8: 100.73, 9: 102.75, 10: 104.78, 11: 106.89, 12: 109.04, 13: 111.25, 14: 113.45, 15: 115.72 },
            CO1: { 1: 81.26, 2: 82.90, 3: 84.56, 4: 86.25, 5: 88.00, 6: 89.72, 7: 91.54, 8: 93.38, 9: 95.38, 10: 97.17, 11: 99.07, 12: 101.05, 13: 103.08, 14: 105.12, 15: 107.22, 16: 108.41, 17: 110.56, 18: 112.81 },
            CO2: { 1: 85.33, 2: 87.08, 3: 88.79, 4: 90.58, 5: 92.40, 6: 94.24, 7: 96.10, 8: 98.04, 9: 100.13, 10: 102.02, 11: 104.03, 12: 106.13, 13: 108.24, 14: 110.42, 15: 112.59, 16: 113.82, 17: 116.12, 18: 118.43 },
            CRNA: { 1: 90.51, 2: 92.32, 3: 94.18, 4: 96.07, 5: 97.95, 6: 99.94, 7: 101.94, 8: 103.96, 9: 106.07, 10: 110.36, 11: 112.53, 12: 114.78, 13: 117.09, 14: 119.41, 15: 121.84 }
        };

        const taRaises = { 2026: 0.05, 2027: 0.05, 2028: 0.045, 2029: 0.04 };
        const ucOffers = { 2026: 0.032, 2027: 0.025, 2028: 0.025, 2029: 0.025, 2030: 0.03 };

        // --- Initial Setup Functions ---
        
        function populateClassificationDropdown() {
            const select = document.getElementById('classification');
            select.innerHTML = ''; // Clear existing options
            for (const key in classificationDetails) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = classificationDetails[key].name;
                select.appendChild(option);
            }
        }

        function populateStepDropdown() {
            const stepSelect = document.getElementById('step');
            stepSelect.innerHTML = ''; // Clear existing options
            // Steps range from 0 (min CN2) to 18 (max CN3/CO2)
            for (let i = 0; i <= 18; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Step ${i}`;
                stepSelect.appendChild(option);
            }
        }

        function populatePayScaleTable() {
            const tbody = document.getElementById('pay-scale-body');
            const thead = document.querySelector('.result-table thead');
            tbody.innerHTML = ''; // Clear body

            // 1. Build Header
            let headerRow = '<tr><th>Step</th>';
            for (const key in classificationDetails) {
                const detail = classificationDetails[key];
                headerRow += `<th>${detail.name} (Min: ${detail.min}, Max: ${detail.max})</th>`;
            }
            headerRow += '</tr>';
            thead.innerHTML = headerRow;

            // 2. Build Body
            const maxStep = 18; // Max step across all classifications
            for (let i = 0; i <= maxStep; i++) {
                let row = `<tr><td>${i}</td>`;
                
                for (const key in classificationDetails) {
                    const wage = payScale[key][i];
                    let cellContent = wage ? `$${wage.toFixed(2)}` : '';
                    row += `<td style="text-align: center;">${cellContent}</td>`;
                }
                
                row += `</tr>`;
                // Only insert the row if it has data (Step 0 for CN2, or Step 17/18 for CN3/COx)
                // We check if at least one classification has data for this step
                const hasData = Object.keys(payScale).some(key => payScale[key][i] !== undefined);
                if (hasData) {
                    tbody.insertAdjacentHTML('beforeend', row);
                }
            }
        }

        // Run setup functions on load
        document.addEventListener('DOMContentLoaded', () => {
            populateClassificationDropdown();
            populateStepDropdown();
            populatePayScaleTable();
        });


        // --- Core Calculation Logic ---

        /**
         * Calculates the wage progression using the compounding logic applied to the new step's 2025 base wage.
         * @param {string} classificationKey - The short code for the classification (e.g., 'CN2').
         * @param {number} startStep - The nurse's current 2025 step.
         * @param {Object} raises - The object of annual percentage raises for the agreement.
         * @returns {Object} { wages: {2025: ..., 2026: ...}, steps: {2025: ..., 2026: ...} }
         */
        function calculateWageProgression(classificationKey, startStep, raises) {
            const details = classificationDetails[classificationKey];
            const maxStep = details.max;

            // Input validation based on the min/max steps provided
            if (startStep < details.min || startStep > maxStep || payScale[classificationKey][startStep] === undefined) {
                console.error(`Error: Step ${startStep} is not valid for ${details.name}.`);
                return null;
            }

            let currentStep = startStep;
            let wages = {};
            let steps = {};
            let cumulativeMultiplier = 1.0;

            // 2025 Base Wage (starting point)
            wages[2025] = payScale[classificationKey][startStep];
            steps[2025] = startStep;

            for (let year = 2026; year <= 2030; year++) {
                const raise = raises[year];

                if (raise === undefined) {
                    // Stop if no raise data for the year (e.g., TA stops at 2029)
                    continue;
                }

                // 1. Determine the step for the current year (Step-up logic)
                if (year > 2026 && currentStep < maxStep) {
                    // Move up 1 step every year, but not counting 2026
                    currentStep++;
                }
                
                // If they have reached maxStep, they stay there
                if (currentStep > maxStep) {
                    currentStep = maxStep;
                }

                // 2. Get the 2025 Base Wage for the current step
                const baseWageAtCurrentStep = payScale[classificationKey][currentStep];

                if (baseWageAtCurrentStep === undefined) {
                    console.error(`Wage data missing for ${details.name} Step ${currentStep} in year ${year}. Nurse at max step? Using previous year's calculated wage rate.`);
                    
                    // If the step is missing (e.g., trying to reach step 16 in NP1, but it maxes at 15), 
                    // this means they are likely at the cap. We use the calculated wage from the previous year.
                    const previousYear = year - 1;
                    wages[year] = wages[previousYear] * (1 + raise);
                    steps[year] = currentStep; // Keep the calculated (but maxed) step for display
                    continue;
                }

                // 3. Update the compounding multiplier
                cumulativeMultiplier *= (1 + raise);

                // 4. Calculate the new wage: 2025 Base Wage * Cumulative Multiplier
                const newWage = baseWageAtCurrentStep * cumulativeMultiplier;

                wages[year] = newWage;
                steps[year] = currentStep;
            }

            return { wages, steps };
        }

        // --- Result Generation and Display ---
        
        let wageChart = null; // Line Chart for Hourly Wage Progression
        let differenceChart = null; // Bar Chart for Annual Wage Increase (2029 vs 2025)
        let annualSalaryChart = null; // Grouped Bar Chart for Annual Salary Comparison

        function generateWages() {
            const classificationKey = document.getElementById('classification').value;
            const startStep = parseInt(document.getElementById('step').value);
            const classificationName = classificationDetails[classificationKey].name;
            const resultsArea = document.getElementById('results-area');

            // --- 1. Calculations ---
            const taResult = calculateWageProgression(classificationKey, startStep, taRaises);
            const ucResult = calculateWageProgression(classificationKey, startStep, ucOffers);

            if (!taResult || !ucResult) {
                // Display error message if calculation failed due to invalid step
                resultsArea.innerHTML = `<div class="result-card ta-note" style="text-align: center;">
                    <p><strong>Error: Step ${startStep} is not valid for ${classificationName}. Please check the 2025 Pay Scale below.</strong></p>
                </div>`;
                resultsArea.style.display = 'block';
                return;
            }
            
            // --- 2. HTML Rendering ---
            let html = `
                <div class="result-card ta-note">
                    <p><strong>Tentative Agreement secured 18.5% pay raise over 4 years v.s. UC Initial Offer 13.7% over 5 years or 10.7% over 4 years. Details below!</strong></p>
                </div>

                <h2>ðŸ’° Estimated Hourly Wage Comparison</h2>
                <p style="text-align: center;"><strong>Classification:</strong> ${classificationName} | <strong>Starting 2025 Step:</strong> ${startStep}</p>

                ${generateComparisonTable(taResult, ucResult)}

                <div class="result-card uc-note">
                    <p><strong>NOTE (UC Initial Offer):</strong> The 27% Pay Raise over 5 years UC kept talking about was **False Marketing Tactics**. They included 2% Step Increase (Which already included in every contracts no matter what), and 3.3% of Lump Sum. Which explained why the inflated number was 27%. Actual pay raise they offered was **13.7% over 5 years**, or **10.7% over 4 years** (excluding 2030).</p>
                </div>
                
                <h2>ðŸ“ˆ Wage Progression Graph (Hourly Rate)</h2>
                <div class="chart-container">
                    <canvas id="wageChart"></canvas>
                </div>

                <!-- Summary Box for Annual Increase (2025 to 2029) -->
                <div id="total-summary-area" class="total-summary" style="margin-top: 20px;">
                    <!-- Annual Increase Summary content will be injected by JS -->
                </div>
                
                <h2>ðŸ’µ Total Annual Wage Increase (2025 Base to 2029 Rate)</h2>
                <div class="chart-container">
                    <canvas id="differenceChart"></canvas>
                </div>

                <!-- Summary Box for Annual Salary Comparison (2029 Final) -->
                <div id="annual-salary-summary-area" class="total-summary" style="margin-top: 20px;">
                    <!-- Annual Salary Summary content will be injected by JS -->
                </div>
                
                <h2> Yearly Annual Salary Comparison (2026-2029)</h2>
                <div class="chart-container">
                    <canvas id="annualSalaryChart"></canvas>
                </div>
            `;
            
            resultsArea.innerHTML = html;
            resultsArea.style.display = 'block';

            // --- 3. Graph Generation ---
            createWageChart(taResult, ucResult);
            createTotalIncreaseChartAndSummary(taResult, ucResult);
            createAnnualSalaryChartAndSummary(taResult, ucResult); 
        }

        function generateComparisonTable(taResult, ucResult) {
            let table = `
                <table class="result-table comparison-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Tentative Agreement (TA)</th>
                            <th>UC Initial Offer (UC)</th>
                            <th>Step (Common)</th>
                            <th>TA Raise</th>
                            <th>UC Raise</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const years = [2025, 2026, 2027, 2028, 2029, 2030];
            
            years.forEach(year => {
                const taWage = taResult.wages[year];
                const ucWage = ucResult.wages[year];
                const step = taResult.steps[year] !== undefined ? taResult.steps[year] : (ucResult.steps[year] !== undefined ? ucResult.steps[year] : '');
                const taR = taRaises[year] ? (taRaises[year] * 100).toFixed(1) + '%' : '';
                const ucR = ucOffers[year] ? (ucOffers[year] * 100).toFixed(1) + '%' : '';

                if (taWage !== undefined || ucWage !== undefined) {
                     table += `
                        <tr>
                            <td>${year}</td>
                            <td>${taWage ? '$' + taWage.toFixed(2) : '-'}</td>
                            <td>${ucWage ? '$' + ucWage.toFixed(2) : '-'}</td>
                            <td style="text-align: center;">${step !== '' ? 'Step ' + step : '-'}</td>
                            <td style="text-align: center;">${taR}</td>
                            <td style="text-align: center;">${ucR}</td>
                        </tr>
                    `;
                }
            });

            table += `</tbody></table>`;
            return table;
        }

        function createWageChart(taResult, ucResult) {
            const labels = Object.keys(taResult.wages).filter(year => parseInt(year) <= 2029).map(year => `${year} (Step ${taResult.steps[year]})`);
            const taData = labels.map(label => {
                const year = label.substring(0, 4);
                return taResult.wages[year];
            });
            const ucData = labels.map(label => {
                const year = label.substring(0, 4);
                return ucResult.wages[year];
            });

            const ctx = document.getElementById('wageChart').getContext('2d');

            if (wageChart) {
                wageChart.destroy();
            }

            wageChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Tentative Agreement (TA)',
                            data: taData,
                            borderColor: varToRgba('--danger-color', 1), 
                            backgroundColor: varToRgba('--danger-color', 0.1),
                            tension: 0.2,
                            pointRadius: 5,
                            fill: false,
                        },
                        {
                            label: 'UC Initial Offer (UC)',
                            data: ucData,
                            borderColor: varToRgba('--primary-color', 1), 
                            backgroundColor: varToRgba('--primary-color', 0.1),
                            tension: 0.2,
                            pointRadius: 5,
                            fill: false,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Hourly Wage Progression Over Time',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Hourly Wage ($)'
                            },
                            beginAtZero: false
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year (and Step)'
                            }
                        }
                    }
                }
            });
        }

        // --- Total Annual Wage Increase (2025 Base to 2029 Rate) ---

        function createTotalIncreaseChartAndSummary(taResult, ucResult) {
            const HOURS_PER_YEAR = 2080; 

            const taIncreaseHourly = taResult.wages[2029] - taResult.wages[2025];
            const totalIncreaseTA = taIncreaseHourly * HOURS_PER_YEAR;

            const ucIncreaseHourly = ucResult.wages[2029] - ucResult.wages[2025];
            const totalIncreaseUC = ucIncreaseHourly * HOURS_PER_YEAR;
            
            const overallDifference = totalIncreaseTA - totalIncreaseUC;

            // 1. Populate the Total Summary Box
            const summaryBox = document.getElementById('total-summary-area');
            
            const formattedTotalIncreaseTA = totalIncreaseTA.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const formattedTotalIncreaseUC = totalIncreaseUC.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const formattedOverallDifference = overallDifference.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const overallDifferenceColor = overallDifference >= 0 ? 'var(--danger-color)' : 'var(--primary-color)';


            summaryBox.innerHTML = `
                <h3>Total Annual Wage Increase (2025 Base to 2029 Rate)</h3>
                <p style="font-size: 1.2em; font-weight: normal; margin-bottom: 5px; color: ${varToRgba('--danger-color', 1)};">
                    TA Increase: <strong>+ $${formattedTotalIncreaseTA}</strong>
                </p>
                <p style="font-size: 1.2em; font-weight: normal; margin-bottom: 10px; color: ${varToRgba('--primary-color', 1)};">
                    UC Offer Increase: <strong>+ $${formattedTotalIncreaseUC}</strong>
                </p>
                <div style="padding-top: 10px; border-top: 1px dashed #ccc; margin-top: 10px;">
                    <p style="font-size: 1.6em; font-weight: bold; color: ${overallDifferenceColor}; margin: 0;">
                        TA Advantage: + $${formattedOverallDifference}
                    </p>
                </div>
                <small>This shows the annual salary increase from the 2025 rate to the 2029 rate (assuming 2,080 work hours/year).</small>
            `;

            // 2. Create the Bar Chart
            const ctx = document.getElementById('differenceChart').getContext('2d');

            if (differenceChart) {
                differenceChart.destroy();
            }

            differenceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Tentative Agreement (TA)', 'UC Initial Offer (UC)'],
                    datasets: [
                        {
                            label: 'Total Annual Wage Increase (2025 to 2029)',
                            data: [totalIncreaseTA, totalIncreaseUC],
                            backgroundColor: [
                                varToRgba('--danger-color', 0.7), // TA Red
                                varToRgba('--primary-color', 0.7) // UC Navy
                            ], 
                            borderColor: [
                                varToRgba('--danger-color', 1),
                                varToRgba('--primary-color', 1)
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false 
                        },
                        title: {
                            display: true,
                            text: 'Total Annual Wage Increase (2025 Base to 2029 Rate)',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (context.parsed.y !== null) {
                                        label += ': $' + context.parsed.y.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Total Annual Increase ($)'
                            },
                            ticks: {
                                callback: function(value, index, values) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            title: {
                                display: false 
                            }
                        }
                    }
                }
            });
        }


        // --- Annual Salary Comparison (Year-by-Year) ---

        function createAnnualSalaryChartAndSummary(taResult, ucResult) {
            const HOURS_PER_YEAR = 2080;
            const years = [2026, 2027, 2028, 2029];
            
            // Calculate Annual Salaries for each year
            const taAnnualSalaries = years.map(year => taResult.wages[year] * HOURS_PER_YEAR);
            const ucAnnualSalaries = years.map(year => ucResult.wages[year] * HOURS_PER_YEAR);
            
            // Summary calculation: Difference in FINAL 2029 Annual Salary
            const ta2029Salary = taAnnualSalaries[taAnnualSalaries.length - 1];
            const uc2029Salary = ucAnnualSalaries[ucAnnualSalaries.length - 1];
            const difference = ta2029Salary - uc2029Salary;
            
            // 1. Populate the Summary Box
            const summaryBox = document.getElementById('annual-salary-summary-area');
            
            const formattedTA2029Salary = ta2029Salary.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const formattedUC2029Salary = uc2029Salary.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const formattedDifference = difference.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            const differenceColor = difference >= 0 ? 'var(--danger-color)' : 'var(--primary-color)';

            summaryBox.innerHTML = `
                <h3>Final Annual Salary Comparison (2029)</h3>
                <p style="font-size: 1.2em; font-weight: normal; margin-bottom: 5px; color: ${varToRgba('--danger-color', 1)};">
                    TA 2029 Annual Salary: <strong>$${formattedTA2029Salary}</strong>
                </p>
                <p style="font-size: 1.2em; font-weight: normal; margin-bottom: 10px; color: ${varToRgba('--primary-color', 1)};">
                    UC Offer 2029 Annual Salary: <strong>$${formattedUC2029Salary}</strong>
                </p>
                <div style="padding-top: 10px; border-top: 1px dashed #ccc; margin-top: 10px;">
                    <p style="font-size: 1.6em; font-weight: bold; color: ${differenceColor}; margin: 0;">
                        TA Annual Advantage in 2029: + $${formattedDifference}
                    </p>
                </div>
                <small>This shows the annual salary difference in the final year of the contract (assuming 2,080 work hours/year).</small>
            `;

            // 2. Create the Bar Chart
            const ctx = document.getElementById('annualSalaryChart').getContext('2d');

            if (annualSalaryChart) {
                annualSalaryChart.destroy();
            }

            annualSalaryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years.map(y => y.toString()),
                    datasets: [
                        {
                            label: 'Tentative Agreement (TA) Annual Salary',
                            data: taAnnualSalaries,
                            backgroundColor: varToRgba('--danger-color', 0.8),
                            borderColor: varToRgba('--danger-color', 1),
                            borderWidth: 1
                        },
                        {
                            label: 'UC Initial Offer (UC) Annual Salary',
                            data: ucAnnualSalaries,
                            backgroundColor: varToRgba('--primary-color', 0.8),
                            borderColor: varToRgba('--primary-color', 1),
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Yearly Annual Salary Comparison (2026-2029)',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (context.parsed.y !== null) {
                                        label += ': $' + context.parsed.y.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: false,
                            title: { display: true, text: 'Contract Year' }
                        },
                        y: {
                            stacked: false,
                            title: { display: true, text: 'Annual Salary ($)' },
                            ticks: {
                                callback: function(value, index, values) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }


        // Helper function to get the actual RGBA color from a CSS variable
        function varToRgba(cssVar, opacity) {
            const color = getComputedStyle(document.documentElement).getPropertyValue(cssVar).trim();
            // A very simple heuristic for converting simple hex/rgb to rgba for Chart.js
            if (color.startsWith('#')) {
                let r = parseInt(color.substring(1, 3), 16);
                let g = parseInt(color.substring(3, 5), 16);
                let b = parseInt(color.substring(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${opacity})`;
            }
            return color; 
        }
    </script>
</body>
</html>
