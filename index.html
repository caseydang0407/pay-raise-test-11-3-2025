<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wage Estimator Sacramento 2026-2029</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        /* Modern, Responsive CSS */
        :root {
            --primary-color: #004d99; /* UC Navy Blue (Used for UC Offers in chart/table) */
            --secondary-color: #f7b731; /* Accent Yellow */
            --background-color: #f4f7f6;
            --text-color: #333;
            --success-color: #28a745;
            --danger-color: #dc3545; /* CNA Red (Used for TA in chart/table) */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 90%;
            margin: 0 auto;
            padding: 20px 10px;
        }

        /* Banner Styling */
        .banner {
            background-color: var(--primary-color);
            color: white;
            padding: 30px 15px;
            text-align: center;
            border-bottom: 5px solid var(--secondary-color);
        }

        .banner h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .banner small {
            display: block;
            margin-top: 5px;
            font-style: italic;
            font-size: 0.85em;
        }

        /* Input Form Styling */
        .input-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            background-color: #fff;
            font-size: 1em;
        }

        button {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #e0a82b;
        }

        /* Instruction Styling */
        .instruction {
            margin-top: 20px;
            padding: 15px;
            background-color: #ffeccf;
            border-left: 5px solid var(--secondary-color);
            border-radius: 5px;
        }

        /* Results Styling */
        #results-area {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px dashed #ccc;
        }

        .result-card {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .result-card h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        
        #results-area h2, #results-area h3 {
            text-align: center;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .result-table th, .result-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .result-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            text-align: center;
        }

        .result-table td:nth-child(1) {
            font-weight: bold;
        }

        /* ONLY colorize the specific comparison table */
        .comparison-table td:nth-child(2) { /* Tentative Agreement (TA) Column - Red */
            background-color: #fff0f6; /* Light Red Background */
            color: var(--danger-color); /* Red Text */
            font-weight: bold;
        }
        .comparison-table td:nth-child(3) { /* UC Initial Offer (UC) Column - Navy Blue */
            background-color: #e6f7ff; /* Light Blue Background */
            color: var(--primary-color); /* Navy Blue Text */
            font-weight: bold;
        }


        .note {
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-size: 0.9em;
            font-style: italic;
        }

        .ta-note {
            background-color: #ffeccf;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            font-weight: bold;
        }
        
        /* NEW: Total Summary Box */
        .total-summary {
            background-color: #fff0f6;
            border: 2px solid var(--danger-color);
            text-align: center;
            padding: 15px;
        }
        .total-summary h3 {
            color: var(--danger-color);
            margin: 0 0 10px 0;
            font-size: 1.3em;
        }
        .total-summary p {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--danger-color);
            margin: 0;
        }
        .total-summary small {
            font-size: 0.85em;
            font-style: italic;
            color: var(--text-color);
            margin-top: 10px;
            display: block;
        }

        .uc-note {
            background-color: #e6f7ff;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .pay-scale {
            margin-top: 30px;
        }

        .pay-scale h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        /* Chart Styling */
        .chart-container {
            width: 100%;
            margin-top: 20px;
            padding: 20px 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Responsive adjustments */
        @media (min-width: 600px) {
            .container {
                max-width: 700px;
            }
            .banner h1 {
                font-size: 2.5em;
            }
            .input-group select {
                padding: 12px;
            }
        }
    </style>
</head>
<body>

    <div class="banner">
        <h1>WAGE ESTIMATOR SACRAMENTO 2026-2029 CNA CONTRACT</h1>
        <small>Disclaimer: Rough estimate, real numbers might vary case by case.</small>
        <small>Coded by AI - Presented by Dai Dang</small>
    </div>

    <div class="container">
        <div class="input-card">
            
            <div class="input-group">
                <label for="classification">Nursing Classification</label>
                <select id="classification">
                    <option value="CN2">Clinical Nurse 2</option>
                    <option value="CN3">Clinical Nurse 3</option>
                </select>
            </div>

            <div class="input-group">
                <label for="step">Step (2025 Current)</label>
                <select id="step">
                    <!-- Options populated by JavaScript -->
                </select>
            </div>

            <button onclick="generateWages()">Generate Comparison</button>

            <div class="instruction">
                <p>***<span style="font-weight: bold; font-style: italic;">Please select your Nursing Classification and Step. Refer to 2025 Pay Scale below for your current step. If you don't know your step, check your paycheck and look for Pay Rate on top of your paycheck and compare to the Pay Scale.***</span></p>
            </div>
        </div>

        <div id="results-area" style="display:none;">
            <!-- Results will be displayed here -->
        </div>
        
        <div class="pay-scale">
            <h2>2025 Current Pay Scale</h2>
            <div class="result-card">
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>Step</th>
                            <th>Clinical Nurse 2 (Min: 0, Max: 16)</th>
                            <th>Clinical Nurse 3 (Min: 1, Max: 18)</th>
                        </tr>
                    </thead>
                    <tbody id="pay-scale-body">
                        <!-- Pay scale data inserted by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // Wage data from the user's table (2025 Base Rates)
        const payScale = {
            CN2: { 0: 70.21, 1: 73.72, 2: 75.17, 3: 76.70, 4: 78.23, 5: 79.84, 6: 81.41, 7: 83.03, 8: 84.69, 9: 86.38, 10: 88.08, 11: 89.89, 12: 91.65, 13: 93.48, 14: 95.37, 15: 97.24, 16: 99.20 },
            CN3: { 1: 77.40, 2: 78.97, 3: 80.54, 4: 82.14, 5: 83.80, 6: 85.46, 7: 87.17, 8: 88.98, 9: 90.82, 10: 92.56, 11: 94.37, 12: 96.27, 13: 98.18, 14: 100.13, 15: 102.12, 16: 103.21, 17: 105.30, 18: 107.45 }
        };

        const taRaises = { 2026: 0.05, 2027: 0.05, 2028: 0.045, 2029: 0.04 };
        const ucOffers = { 2026: 0.032, 2027: 0.025, 2028: 0.025, 2029: 0.025, 2030: 0.03 };

        // --- Initial Setup Functions ---
        
        function populateStepDropdown() {
            const stepSelect = document.getElementById('step');
            // Populate steps 0 through 18
            for (let i = 0; i <= 18; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Step ${i}`;
                stepSelect.appendChild(option);
            }
        }

        function populatePayScaleTable() {
            const tbody = document.getElementById('pay-scale-body');
            for (let i = 0; i <= 18; i++) {
                let cn2Wage = payScale.CN2[i] ? `$${payScale.CN2[i].toFixed(2)}` : '';
                let cn3Wage = payScale.CN3[i] ? `$${payScale.CN3[i].toFixed(2)}` : '';

                let row = `
                    <tr>
                        <td>${i}</td>
                        <td style="text-align: center;">${cn2Wage}</td>
                        <td style="text-align: center;">${cn3Wage}</td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            }
        }

        // Run setup functions on load
        document.addEventListener('DOMContentLoaded', () => {
            populateStepDropdown();
            populatePayScaleTable();
        });


        // --- Core Calculation Logic ---

        /**
         * Calculates the wage progression using the compounding logic applied to the new step's 2025 base wage.
         * @param {string} classification - 'CN2' or 'CN3'.
         * @param {number} startStep - The nurse's current 2025 step.
         * @param {Object} raises - The object of annual percentage raises for the agreement.
         * @returns {Object} { wages: {2025: ..., 2026: ...}, steps: {2025: ..., 2026: ...} }
         */
        function calculateWageProgression(classification, startStep, raises) {
            const minStep = classification === 'CN2' ? 0 : 1;
            const maxStep = classification === 'CN2' ? 16 : 18;

            // Input validation based on the min/max steps provided
            if (startStep < minStep || startStep > maxStep || payScale[classification][startStep] === undefined) {
                console.error(`Error: Step ${startStep} is not valid for ${classification === 'CN2' ? 'Clinical Nurse 2' : 'Clinical Nurse 3'}.`);
                return null;
            }

            let currentStep = startStep;
            let wages = {};
            let steps = {};
            let cumulativeMultiplier = 1.0;

            // 2025 Base Wage (starting point)
            wages[2025] = payScale[classification][startStep];
            steps[2025] = startStep;

            for (let year = 2026; year <= 2030; year++) {
                const raise = raises[year];

                if (raise === undefined) {
                    // Stop if no raise data for the year (e.g., TA stops at 2029)
                    continue;
                }

                // 1. Determine the step for the current year (Step-up logic)
                if (year > 2026 && currentStep < maxStep) {
                    // Move up 1 step every year, but not counting 2026
                    currentStep++;
                }
                
                // If they have reached maxStep, they stay there
                if (currentStep > maxStep) {
                    currentStep = maxStep;
                }

                // 2. Get the 2025 Base Wage for the current step
                const baseWageAtCurrentStep = payScale[classification][currentStep];

                if (baseWageAtCurrentStep === undefined) {
                    console.error(`Wage data missing for ${classification} Step ${currentStep} in year ${year}. Calculation aborted.`);
                    continue;
                }

                // 3. Update the compounding multiplier
                cumulativeMultiplier *= (1 + raise);

                // 4. Calculate the new wage: 2025 Base Wage * Cumulative Multiplier
                const newWage = baseWageAtCurrentStep * cumulativeMultiplier;

                wages[year] = newWage;
                steps[year] = currentStep;
            }

            return { wages, steps };
        }

        // --- Result Generation and Display ---
        
        let wageChart = null; // Variable for the first chart
        let differenceChart = null; // Variable for the SECOND chart

        function generateWages() {
            const classification = document.getElementById('classification').value;
            const startStep = parseInt(document.getElementById('step').value);
            const classificationName = classification === 'CN2' ? 'Clinical Nurse 2' : 'Clinical Nurse 3';
            const resultsArea = document.getElementById('results-area');

            // --- 1. Calculations ---
            const taResult = calculateWageProgression(classification, startStep, taRaises);
            const ucResult = calculateWageProgression(classification, startStep, ucOffers);

            if (!taResult || !ucResult) {
                resultsArea.style.display = 'none';
                return;
            }
            
            // --- 2. HTML Rendering (Now includes new elements for summary and 2nd chart) ---
            let html = `
                <div class="result-card ta-note">
                    <p><strong>Tentative Agreement secured 18.5% pay raise over 4 years v.s. UC Initial Offer 13.7% over 5 years or 10.7% over 4 years. Details below!</strong></p>
                </div>

                <h2>ðŸ’° Estimated Hourly Wage Comparison</h2>
                <p style="text-align: center;"><strong>Classification:</strong> ${classificationName} | <strong>Starting 2025 Step:</strong> ${startStep}</p>

                ${generateComparisonTable(taResult, ucResult)}

                <div class="result-card uc-note">
                    <p><strong>NOTE (UC Initial Offer):</strong> The 27% Pay Raise over 5 years UC kept talking about was **False Marketing Tactics**. They included 2% Step Increase (Which already included in every contracts no matter what), and 3.3% of Lump Sum. Which explained why the inflated number was 27%. Actual pay raise they offered was **13.7% over 5 years**, or **10.7% over 4 years** (excluding 2030).</p>
                </div>
                
                <h2>ðŸ“ˆ Wage Progression Graph</h2>
                <div class="chart-container">
                    <canvas id="wageChart"></canvas>
                </div>

                <!-- NEW: Summary Box and 2nd Chart -->
                <div id="total-summary-area" class="result-card total-summary">
                    <!-- Summary content will be injected by JS -->
                </div>
                
                <h2>ðŸ’µ TA vs. UC: Additional Annual Salary</h2>
                <div class="chart-container">
                    <canvas id="differenceChart"></canvas>
                </div>
            `;
            
            resultsArea.innerHTML = html;
            resultsArea.style.display = 'block';

            // --- 3. Graph Generation ---
            createWageChart(taResult, ucResult);
            // NEW: Call function to create the second chart and summary
            createDifferenceChartAndSummary(taResult, ucResult); 
        }

        function generateComparisonTable(taResult, ucResult) {
            // Added .comparison-table class here to specifically target this table for colorization
            let table = `
                <table class="result-table comparison-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Tentative Agreement (TA)</th>
                            <th>UC Initial Offer (UC)</th>
                            <th>Step (Common)</th>
                            <th>TA Raise</th>
                            <th>UC Raise</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const years = [2025, 2026, 2027, 2028, 2029, 2030];
            
            years.forEach(year => {
                const taWage = taResult.wages[year];
                const ucWage = ucResult.wages[year];
                const step = taResult.steps[year] !== undefined ? taResult.steps[year] : (ucResult.steps[year] !== undefined ? ucResult.steps[year] : '');
                const taR = taRaises[year] ? (taRaises[year] * 100).toFixed(1) + '%' : '';
                const ucR = ucOffers[year] ? (ucOffers[year] * 100).toFixed(1) + '%' : '';

                // Only show rows where at least one wage is defined
                if (taWage !== undefined || ucWage !== undefined) {
                     table += `
                        <tr>
                            <td>${year}</td>
                            <td>${taWage ? '$' + taWage.toFixed(2) : '-'}</td>
                            <td>${ucWage ? '$' + ucWage.toFixed(2) : '-'}</td>
                            <td style="text-align: center;">${step !== '' ? 'Step ' + step : '-'}</td>
                            <td style="text-align: center;">${taR}</td>
                            <td style="text-align: center;">${ucR}</td>
                        </tr>
                    `;
                }
            });

            table += `</tbody></table>`;
            return table;
        }

        function createWageChart(taResult, ucResult) {
            // Get years up to 2029 for the main 4-year comparison graph labels
            const labels = Object.keys(taResult.wages).filter(year => parseInt(year) <= 2029).map(year => `${year} (Step ${taResult.steps[year]})`);
            const taData = labels.map(label => {
                const year = label.substring(0, 4);
                return taResult.wages[year];
            });
            const ucData = labels.map(label => {
                const year = label.substring(0, 4);
                return ucResult.wages[year];
            });

            const ctx = document.getElementById('wageChart').getContext('2d');

            // Destroy the previous chart instance if it exists
            if (wageChart) {
                wageChart.destroy();
            }

            wageChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Tentative Agreement (TA)',
                            data: taData,
                            // FLIPPED COLOR: Uses Danger (Red) for TA
                            borderColor: varToRgba('--danger-color', 1), 
                            backgroundColor: varToRgba('--danger-color', 0.1),
                            tension: 0.2,
                            pointRadius: 5,
                            fill: false,
                        },
                        {
                            label: 'UC Initial Offer (UC)',
                            data: ucData,
                            // FLIPPED COLOR: Uses Primary (Navy Blue) for UC
                            borderColor: varToRgba('--primary-color', 1), 
                            backgroundColor: varToRgba('--primary-color', 0.1),
                            tension: 0.2,
                            pointRadius: 5,
                            fill: false,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Hourly Wage Progression Over Time',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Hourly Wage ($)'
                            },
                            beginAtZero: false
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year (and Step)'
                            }
                        }
                    }
                }
            });
        }

        // --- NEW: Second Chart and Summary Function ---

        function createDifferenceChartAndSummary(taResult, ucResult) {
            const HOURS_PER_YEAR = 2080; // Standard 40-hour work week
            const labels = [];
            const diffData = [];
            let totalDifference = 0;

            const years = [2026, 2027, 2028, 2029]; // Compare the 4 years of the TA

            years.forEach(year => {
                // We must have data for both to compare
                if (taResult.wages[year] && ucResult.wages[year]) {
                    labels.push(year);
                    const hourlyDiff = taResult.wages[year] - ucResult.wages[year];
                    const annualDiff = hourlyDiff * HOURS_PER_YEAR;
                    diffData.push(annualDiff);
                    totalDifference += annualDiff;
                }
            });

            // 1. Populate the Total Summary Box
            const summaryBox = document.getElementById('total-summary-area');
            summaryBox.innerHTML = `
                <h3>Total Additional Earnings (2026-2029)</h3>
                <p>+ $${totalDifference.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
                <small>Based on the Tentative Agreement vs. the UC Initial Offer over 4 years (assumes 2,080 work hours/year).</small>
            `;

            // 2. Create the Bar Chart
            const ctx = document.getElementById('differenceChart').getContext('2d');

            if (differenceChart) {
                differenceChart.destroy();
            }

            differenceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Additional Annual Salary (TA vs UC)',
                            data: diffData,
                            backgroundColor: varToRgba('--danger-color', 0.7), // Use TA Red
                            borderColor: varToRgba('--danger-color', 1),
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false // Only one dataset, legend is redundant
                        },
                        title: {
                            display: true,
                            text: 'Additional Money Earned Per Year (TA vs. UC)',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Additional Salary ($)'
                            },
                            ticks: {
                                // Format ticks as currency
                                callback: function(value, index, values) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year'
                            }
                        }
                    }
                }
            });
        }


        // Helper function to get the actual RGBA color from a CSS variable
        function varToRgba(cssVar, opacity) {
            const color = getComputedStyle(document.documentElement).getPropertyValue(cssVar).trim();
            // A very simple heuristic for converting simple hex/rgb to rgba for Chart.js
            if (color.startsWith('#')) {
                let r = parseInt(color.substring(1, 3), 16);
                let g = parseInt(color.substring(3, 5), 16);
                let b = parseInt(color.substring(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${opacity})`;
            }
            return color; 
        }
    </script>
</body>
</html>
